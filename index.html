<html>
  <head>
    <title>Nimiq Offline Wallet</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  </head>
  <body>
    <div>
      <span>
        <label for="wallet_pattern">Wallet Pattern </label>
        <input
          text="text"
          id="wallet_pattern"
          name="name"
          placeholder="^NQ[0-9][0-9]"
          value="^NQ[0-9][0-9] BEER"
        />
        <label for="cpu_count">CPU count</label>
        <input id="cpu_count" type="number" min="1" />
      </span>
      <span>
        <button id="generateWallet" onclick="OfflineWallet.generateWallet()">
          Generate Wallet
        </button>
        <button id="stop" onclick="OfflineWallet.stopSearch()">Stop</button>
      </span>
    </div>
    <div id="wallets"></div>

    <script type="module">
      import { default as Iqons, makeHash, IqonsAssets } from "./dist/iqons.bundle.min.js";
      import WalletGenerator from './src/WalletGenerator.js';
      const wasmUrl = `/dist/worker-wasm.wasm`;
      const workerUrl = `/src/WebWorker.js`;

      const target_dom_element = document.getElementById('wallets');
      const $walletPattern = document.getElementById('wallet_pattern');
      const $cpuCount = document.getElementById('cpu_count');
      $cpuCount.max = navigator.hardwareConcurrency || 1;
      $cpuCount.value = navigator.hardwareConcurrency;
      let cpuCount = Number($cpuCount.value);
      WalletGenerator.init({ workerUrl, wasmUrl, cpuCount });
      function stopSearch() {
        WalletGenerator.stopSearch();
      }
      function generateWallet() {
        let searchPattern = $walletPattern.value || '^NQ[0-9][0-9] BE';
        WalletGenerator
          .search({searchPattern})
          .then(async ({ wallet, mnemonicPrivateKeyLegacy }) => {
            const svgIcon = await Iqons.svg(wallet);
            target_dom_element.insertAdjacentHTML(
              `beforeend`,
              ` <pre>${wallet}</pre>
                <pre>${mnemonicPrivateKeyLegacy}</pre>
                ${svgIcon}
              `
            );
          })
          .catch(error => alert(error));
      }
      $cpuCount.addEventListener('change', e => {
        cpuCount = Number(e.target.value);
        WalletGenerator.scaleSearch(e.target.value);
      });
      window.OfflineWallet = {
        generateWallet,
        stopSearch,
      }
    </script>
  </body>
</html>
